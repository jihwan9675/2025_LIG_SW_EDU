<Window x:Class="SAMSimulationSystem.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SAMSimulationSystem"
        xmlns:helix="clr-namespace:HelixToolkit.Wpf;assembly=HelixToolkit.Wpf"
        mc:Ignorable="d"
        Title="SAMS" Height="800" Width="1400">

    <Grid Background="Black">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.7*" />
            <ColumnDefinition Width="0.3*" />
        </Grid.ColumnDefinitions>

        <helix:HelixViewport3D x:Name="view3d" Background="Black" ZoomExtentsWhenLoaded="True">
            <helix:DefaultLights/>
            <!-- Ground Grid -->
            <helix:GridLinesVisual3D Width="90" Length="60" MajorDistance="2" Normal="0,0,1" Center="0,-1.5,0" Fill="Gray"/>

            <!-- Korea Map -->
            <helix:RectangleVisual3D Width="69" Length="60" Normal="0,0,1">
                <helix:RectangleVisual3D.Material>
                    <DiffuseMaterial>
                        <DiffuseMaterial.Brush>
                            <ImageBrush ImageSource="Assets/Korea_DTED.png" />
                        </DiffuseMaterial.Brush>
                    </DiffuseMaterial>
                </helix:RectangleVisual3D.Material>
            </helix:RectangleVisual3D>
            
            <!-- Threat -->
            <helix:SphereVisual3D Radius="0.28" Fill="Crimson">
                <helix:SphereVisual3D.Transform>
                    <TranslateTransform3D OffsetX="{Binding ThreatSphereOffsetX}" OffsetY="{Binding ThreatSphereOffsetY}" OffsetZ="{Binding ThreatSphereOffsetZ}"/>
                </helix:SphereVisual3D.Transform>
            </helix:SphereVisual3D>

            <!-- Radar Visual: circle (range) -->
            <helix:LinesVisual3D Color="Lime" Thickness="1" Points="{Binding RadarCircle}"/>

            <!-- Radar sweep line -->
            <helix:LinesVisual3D Color="Lime" Thickness="2" Points="{Binding RadarSweepLine}"/>

            <!-- Radar sector (semi-transparent mesh) -->
            <ModelVisual3D Content="{Binding RadarSectorModel}" />

            <!-- Launcher position visual -->
            <helix:SphereVisual3D Radius="0.2" Fill="BLUE">
                <helix:SphereVisual3D.Transform>
                    <TranslateTransform3D OffsetX="{Binding LauncherOffsetX}" OffsetY="{Binding LauncherOffsetY}" OffsetZ="{Binding LauncherOffsetZ}"/>
                </helix:SphereVisual3D.Transform>
            </helix:SphereVisual3D>

            <!-- Interceptor model placeholder (will be added dynamically) -->
            <ModelVisual3D x:Name="InterceptorModelPlaceholder" />

            <!-- Paths -->
            <helix:LinesVisual3D Color="Crimson" Thickness="1.5" Points="{Binding ThreatPath}"/>
            <helix:LinesVisual3D Color="Cyan" Thickness="1.5" Points="{Binding InterceptorPath}"/>

            <!-- Explosion sphere -->
            <helix:SphereVisual3D Radius="0.6" Fill="Orange" Visible="{Binding IsVisibleExplosionSphere}">
                <helix:SphereVisual3D.Transform>
                    <TranslateTransform3D OffsetX="{Binding ExplosionSphereOffsetX}" OffsetY="{Binding ExplosionSphereOffsetY}" OffsetZ="{Binding ExplosionSphereOffsetZ}"/>
                </helix:SphereVisual3D.Transform>
            </helix:SphereVisual3D>
        </helix:HelixViewport3D>

        <!-- Control Panel -->
        <StackPanel Grid.Column="1" Margin="12">
            <TextBlock Text="SAM Simulation System" FontWeight="Bold" FontSize="18" Foreground="White" Margin="0,0,0,10"/>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <Button Content="Start" Width="80" Command="{Binding StartMissionCommand}"/>
                <Button Content="Stop" Width="80" Command="{Binding StopMissionCommand}" Margin="8,0,0,0"/>
                <Button Content="Reset" Width="80" Command="{Binding ResetMissionCommand}" Margin="8,0,0,0"/>
            </StackPanel>

            <TextBlock Text="Radar 설정" FontWeight="Bold" Foreground="White" Margin="0,8,0,4"/>
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,2">
                    <TextBlock Text="Range:" Width="150" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding StrRadarRange}" Width="140"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,2">
                    <TextBlock Text="Sweep Speed (deg/s):" Width="150" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding StrSweepSpeed}" Width="140"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,2">
                    <TextBlock Text="Sector Angle (deg):" Width="150" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding StrSectorAngle}" Width="140"/>
                </StackPanel>
            </StackPanel>

            <TextBlock Text="Threat 설정" FontWeight="Bold" Foreground="White" Margin="0,10,0,4"/>
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,2">
                    <TextBlock Text="Speed:" Width="150" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding StrThreatSpeed}" Width="140"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,2">
                    <TextBlock Text="Init (x,y,z):" Width="150" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding StrThreatInit}" Width="140"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,2">
                    <TextBlock Text="Dir (x,y,z):" Width="150" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding StrThreatDir}" Width="140"/>
                </StackPanel>
            </StackPanel>

            <TextBlock Text="Interceptor 설정" FontWeight="Bold" Foreground="White" Margin="0,10,0,4"/>
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,2">
                    <TextBlock Text="Speed:" Width="150" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding StrInterceptorSpeed}" Width="140"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,2">
                    <TextBlock Text="Launcher (x,y,z):" Width="150" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding StrLauncherPos}" Width="140"/>
                </StackPanel>
            </StackPanel>

            <TextBlock Text="정보" FontWeight="Bold" Foreground="White" Margin="0,10,0,4"/>
            <TextBlock x:Name="TxtInfo" Text="{Binding StrInfo}" Foreground="White" TextWrapping="Wrap"/>

            <TextBlock Text="Radar 2D 화면" FontWeight="Bold" Foreground="White" Margin="0,10,0,4"/>
            <Canvas x:Name="Radar2DCanvas" Width="280" Height="280" Background="Black" Margin="0,0,0,10" ClipToBounds="True">
                <Ellipse x:Name="RadarCircle2D" Width="280" Height="280" Stroke="Lime" StrokeThickness="1" />
                <Line x:Name="RadarSweepLine2D" Stroke="Lime" StrokeThickness="2"
                      X1="{Binding RadarSweepLine2DX1}"
                      X2="{Binding RadarSweepLine2DX2}"
                      Y1="{Binding RadarSweepLine2DY1}"
                      Y2="{Binding RadarSweepLine2DY2}"/>
                <Ellipse Width="8" Height="8" Stroke="Red" Fill="Red" StrokeThickness="1" 
                         Canvas.Left="{Binding DetectedX}" Canvas.Top="{Binding DetectedY}"
                         Opacity="{Binding DetectedEllipseOpacity}" Visibility="{Binding DetectedEllipseVisibility}"/>
            </Canvas>
        </StackPanel>
    </Grid>
</Window>
